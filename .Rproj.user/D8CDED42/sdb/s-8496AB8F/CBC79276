{
    "collab_server" : "",
    "contents" : "library(readxl)\nlibrary(rDolphin)\nMetadata_Hamza <- read_excel(\"C:/Bruker/TopSpin3.2/data/RamirezN/data_analysis/Metadata_Hamza.xlsx\")\nMetadata_Hamza=as.data.frame(Metadata_Hamza)\n\nProfilingDolphin2017_05_17revision <- data.matrix(read_excel(\"C:/Bruker/TopSpin3.2/data/RamirezN/data_analysis/ProfilingDolphin2017_05_17revision.xlsx\"))\nProfilingDolphin2017_05_17revision=ProfilingDolphin2017_05_17revision/ProfilingDolphin2017_05_17revision[,12]\n\n\nshift <- as.data.frame(read_excel(\"C:/Bruker/TopSpin3.2/data/RamirezN/data_analysis/ProfilingDolphin2017_05_17revision.xlsx\",sheet='Hoja3'))\nshift=shift-replicate(ncol(shift),shift$Glucose)\nshift$Glucose=NULL\nPCAcomp=prcomp(scale(shift))$x\nplot(PCAcomp)\n\nshift_metadata=rep(NA,nrow(shift))\nshift_metadata[PCAcomp<0]=0\nshift_metadata[PCAcomp>0]=1\nrDolphin::p_values(shift,cbind(seq(nrow(shift)),shift_metadata))\n\n\naa=rDolphin::import_data(\"C:/Bruker/TopSpin3.2/data/RamirezN/data_analysis/Parameters_Simoes_combined.csv\")\naa$dataset=alignment(aa$dataset,aa$buck_step)\naa$dataset=aa$dataset/ProfilingDolphin2017_05_17revision[,12]\naa$ppm[3900]\n#\n# aaaa=matrix(NA,0,ncol(aa$dataset))\n# uni=unique(Metadata_Hamza[,8])\n# for (i in seq_along(uni)) {\n# if (length(which((Metadata_Hamza[,8]==i&Metadata_Hamza[,10]=='1_1')==T))==2) {\n# aaaa=rbind(aaaa,aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='C'&Metadata_Hamza[,10]=='1_1',],aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='SHS'&Metadata_Hamza[,10]=='1_1',])\n# }}\n# metadata=rep(1:2,8)\n# types=unique(metadata)\n# mediandataset=matrix(NA,0,ncol(aaaa))\n# for (i in 1:length(types)) mediandataset=rbind(mediandataset,apply(aaaa[which(metadata==types[i]),,drop=F],2,median))\n# p_value_bucketing=as.vector(p_values(aaaa,cbind(c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8),metadata)))\n# aaaa=matrix(NA,0,ncol(aa$dataset))\n# uni=unique(Metadata_Hamza[,8])\n# for (i in seq_along(uni)) {\n# if (length(which((Metadata_Hamza[,8]==i&Metadata_Hamza[,10]=='1_2')==T))==2) {\n# aaaa=rbind(aaaa,aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='C'&Metadata_Hamza[,10]=='1_2',],aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='SHS'&Metadata_Hamza[,10]=='1_2',])\n# }}\n# metadata=rep(1:2,8)\n# types=unique(metadata)\n# for (i in 1:length(types)) mediandataset=rbind(mediandataset,apply(aaaa[which(metadata==types[i]),,drop=F],2,median))\n# p_value_bucketing2=as.vector(p_values(aaaa,cbind(c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8),metadata)))\n# aaaa=matrix(NA,0,ncol(aa$dataset))\n# uni=unique(Metadata_Hamza[,8])\n# for (i in seq_along(uni)) {\n# if (length(which((Metadata_Hamza[,8]==i&Metadata_Hamza[,10]=='2_1')==T))==2) {\n# aaaa=rbind(aaaa,aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='C'&Metadata_Hamza[,10]=='2_1',],aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='SHS'&Metadata_Hamza[,10]=='2_1',])\n# }}\n# metadata=rep(1:2,8)\n# types=unique(metadata)\n# for (i in 1:length(types)) mediandataset=rbind(mediandataset,apply(aaaa[which(metadata==types[i]),,drop=F],2,median))\n# p_value_bucketing3=as.vector(p_values(aaaa,cbind(c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8),metadata)))\n# types=c('1_1_C','1_1_SHS','1_2_C','1_2_SHS','2_1_C','2_1_SHS')\n# ay <- list(tickfont = list(color = \"red\"),overlaying = \"y\",side = \"right\",title = \"p value\",range = c(0,max(mediandataset)))\n# az = list(title = \"Intensity\",range = c(-1, max(mediandataset)-1))\n# p=plot_ly(x=~aa$ppm)\n# for (i in seq(nrow(mediandataset))){\n# p=p%>%add_lines(y = mediandataset[i,],name=types[i])\n# }\n# p=p%>%add_lines(y = ~p_value_bucketing,name='p value 1_1 ', yaxis = \"y2\",line = list(color = 'rgba(255, 0, 0, 1)'))\n# p=p%>%add_lines(y = ~p_value_bucketing2,name='p value 1_2', yaxis = \"y2\",line = list(color = 'rgba(255, 0, 0, 0.66)'))\n# p=p%>%add_lines(y = ~p_value_bucketing3,name='p value 2_1', yaxis = \"y2\",line = list(color = 'rgba(255, 0, 0, 0.33)'))\n# p=p%>%layout(xaxis=list(title='ppm',range=c(max(aa$ppm),min(aa$ppm))),yaxis=az, yaxis2 = ay)\n# p\n#\n#\n\n\naaaa=matrix(NA,0,ncol(aa$dataset))\nuni=unique(Metadata_Hamza[,8])\nfor (i in seq_along(uni)) {\n  if (length(which((Metadata_Hamza[,8]==i&Metadata_Hamza[,10]=='1_1')==T))==2) {\n    aaaa=rbind(aaaa,aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='C'&Metadata_Hamza[,10]=='1_1',],aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='SHS'&Metadata_Hamza[,10]=='1_1',])\n  }}\nfor (i in seq_along(uni)) {\n  if (length(which((Metadata_Hamza[,8]==i&Metadata_Hamza[,10]=='1_2')==T))==2) {\n    aaaa=rbind(aaaa,aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='C'&Metadata_Hamza[,10]=='1_2',],aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='SHS'&Metadata_Hamza[,10]=='1_2',])\n  }}\n\naaaa=aaaa[17:32,]-aaaa[1:16,]\nmetadata=rep(1:2,8)\ntypes=unique(metadata)\nmediandataset=matrix(NA,0,ncol(aaaa))\nfor (i in 1:length(types)) mediandataset=rbind(mediandataset,apply(aaaa[which(metadata==types[i]),,drop=F],2,median))\np_value_bucketing=as.vector(p_values(aaaa,cbind(c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8),metadata)))\n\nay <- list(tickfont = list(color = \"red\"),overlaying = \"y\",side = \"right\",title = \"p value\",range = c(0,max(mediandataset)))\naz = list(title = \"Intensity\",range = c(-1, max(mediandataset)-1))\ntypes=c(\"C\",\"SHS\")\np=plot_ly(x=~aa$ppm)\nfor (i in seq(nrow(mediandataset))){\n  p=p%>%add_lines(y = mediandataset[i,],name=types[i])\n}\n\np_value_bucketing=c(1,rollmean(p_value_bucketing, 3),1)\n\np_value_bucketing[p_value_bucketing>0.05]=0.05\np_value_bucketing[p_value_bucketing<0.05]=0\np=p%>%add_lines(y = ~p_value_bucketing,name='p value 1_1')\np=p%>%layout(xaxis=list(title='ppm',range=c(max(aa$ppm),min(aa$ppm))))\n# p2=plot_ly(x=~aa$ppm)%>%add_lines(y = p_value_bucketing)%>%layout(xaxis=list(title='ppm',range=c(max(aa$ppm),min(aa$ppm))))\n\n\n\n\n\n\naaaa=matrix(NA,0,ncol(aa$dataset))\nuni=unique(Metadata_Hamza[,8])\nfor (i in seq_along(uni)) {\n  if (length(which((Metadata_Hamza[,8]==i&Metadata_Hamza[,10]=='1_1')==T))==2) {\n    aaaa=rbind(aaaa,aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='C'&Metadata_Hamza[,10]=='1_1',],aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='SHS'&Metadata_Hamza[,10]=='1_1',])\n  }}\nfor (i in seq_along(uni)) {\n  if (length(which((Metadata_Hamza[,8]==i&Metadata_Hamza[,10]=='2_1')==T))==2) {\n    aaaa=rbind(aaaa,aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='C'&Metadata_Hamza[,10]=='2_1',],aa$dataset[Metadata_Hamza[,8]==i&Metadata_Hamza[,9]=='SHS'&Metadata_Hamza[,10]=='2_1',])\n  }}\n\naaaa=aaaa[17:32,]-aaaa[1:16,]\nmetadata=rep(1:2,8)\ntypes=unique(metadata)\nmediandataset=matrix(NA,0,ncol(aaaa))\nfor (i in 1:length(types)) mediandataset=rbind(mediandataset,apply(aaaa[which(metadata==types[i]),,drop=F],2,median))\np_value_bucketing=as.vector(p_values(aaaa,cbind(c(1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8),metadata)))\n\nay <- list(tickfont = list(color = \"red\"),overlaying = \"y\",side = \"right\",title = \"p value\",range = c(0,max(mediandataset)))\naz = list(title = \"Intensity\",range = c(-1, max(mediandataset)-1))\ntypes=c(\"C\",\"SHS\")\np=plot_ly(x=~aa$ppm)\nfor (i in seq(nrow(mediandataset))){\n  p=p%>%add_lines(y = mediandataset[i,],name=types[i])\n}\n\np_value_bucketing=c(1,rollmean(p_value_bucketing, 3),1)\n\np_value_bucketing[p_value_bucketing>0.05]=0.05\np_value_bucketing[p_value_bucketing<0.05]=0\np=p%>%add_lines(y = ~p_value_bucketing,name='p value 1_1')\np=p%>%layout(xaxis=list(title='ppm',range=c(max(aa$ppm),min(aa$ppm))))\n# p2=plot_ly(x=~aa$ppm)%>%add_lines(y = p_value_bucketing)%>%layout(xaxis=list(title='ppm',range=c(max(aa$ppm),min(aa$ppm))))\n\n\n\n\n\n\np=plot_ly(x=~aa$ppm[3800:4500])\nfor (i in seq(1,15,2)){\n  p=p%>%add_lines(y = aaaa[i,3800:4500],color='blue')\n}\nfor (i in seq(2,16,2)){\n  p=p%>%add_lines(y = aaaa[i,3800:4500],color='red')\n}\n\n\nfor (i in seq(17,31,2)){\n  p=p%>%add_lines(y = aaaa[i,3800:4500],color='orange')\n}\nfor (i in seq(18,32,2)){\n  p=p%>%add_lines(y = aaaa[i,3800:4500],color='black')\n}\n\n\n\nay <- list(tickfont = list(color = \"red\"),overlaying = \"y\",side = \"right\",title = \"p value\",range = c(0,10))\naz = list(title = \"Intensity\",range = c(-1, 10-1))\n\np=plot_ly(x=~aa$ppm)\np=p%>%add_lines(y = apply(aa$dataset[27:43,],2,median))\np=p%>%add_lines(y = apply(aa$dataset[-c(27:43),],2,median))\np_value_bucketing=as.vector(p_values(aa$dataset,cbind(1:137,rep(c(1,2,1),c(26,17,94)))))\np=p%>%add_lines(y = ~p_value_bucketing,name='p value', yaxis = \"y2\",line = list(color = 'rgba(255, 0, 0, 1)'))\np=p%>%layout(xaxis=list(title='ppm',range=c(max(aa$ppm),min(aa$ppm))),yaxis=az, yaxis2 = ay)\n\naa$ppm[3900]\n",
    "created" : 1496122118152.000,
    "dirty" : true,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1465491015",
    "id" : "CBC79276",
    "lastKnownWriteTime" : 1496122168,
    "last_content_update" : 1496122775026,
    "path" : "C:/Bruker/TopSpin3.2/data/RamirezN/data_analysis/estudi_2.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}