{
    "collab_server" : "",
    "contents" : "\nlibrary(readr)\nlibrary(data.table)\nlibrary(mlbench)\nlibrary(caret)\n# load the data\n\ncontrol <- rfeControl(functions=rfFuncs,  method = \"repeatedcv\",repeats = 5)\n\nlibrary(readxl)\n# combined_mtbls374 <- as.data.frame(read_excel(\"~/combined_mtbls374.xlsx\"))\nlibrary(missForest)\nshift <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/MTBLS374_session_4_associated_data/shift.csv\")[,-1])\nfitting_error <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/MTBLS374_session_4_associated_data/fitting_error.csv\")[,-1])\nsignal_area_ratio <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/MTBLS374_session_4_associated_data/signal_area_ratio.csv\")[,-1])\nArea=data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/MTBLS374_session_4_associated_data/quantification.csv\")[,-1])\nind=which(is.na(colSums(fitting_error)))\nArea[signal_area_ratio<5]=NA\nArea[,-ind][fitting_error[,-ind]>0.08]=NA\n\nshift[signal_area_ratio<5]=NA\nshift[,-ind][fitting_error[,-ind]>0.08]=NA\nshift=shift[,-ind]\n\naa=fread(\"C:/Bruker/TopSpin3.2/data/MTBLS374/s_BoEfRTP2 Serum NMR.txt\")\naa=aa[which(!is.na(aa$`Factor Value[smoking status]`)),]\nmetadata=factor(aa$`Factor Value[smoking status]`)\nfor (j in unique(metadata)) {\n  for (i in seq(ncol(Area))) {\n    Area[(Area[which(metadata==j),i] %in% boxplot.stats(Area[which(metadata==j),i])$out),i]=NA\n  }\nfor (i in seq(ncol(shift))) {\n  shift[(shift[which(metadata==j),i] %in% boxplot.stats(shift[which(metadata==j),i])$out),i]=NA\n}\n}\n\nind=apply(Area,2,function(x)length(which(is.na(x))))\n\nArea_clean=Area[,ind<30]\nind=apply(shift,2,function(x)length(which(is.na(x))))\n\nshift_clean=shift[,ind<30]\nind=c()\ndef=sapply(colnames(Area_clean),function(x)substr(x,1,nchar(x)-2))\ndef2=which(duplicated(def)==F)\ndef4=apply(Area_clean,2,function(x)length(which(is.na(x))))\nfor (i in def2) {\n  def3=which(def==def[i])\n  ind=c(ind,def3[which.min(def4[def3])])\n}\nArea_clean=Area_clean[,ind]\n\ncolnames(shift_clean)=paste(colnames(shift_clean),'shift',sep='_')\n\ncombined_mtbls374=as.data.frame(cbind(Area_clean,shift_clean))\n\nmiss=missForest(data.matrix(combined_mtbls374))$ximp\nmiss2=scale(miss,center=T,scale=T)\nresults <- rfe(miss2, metadata, sizes=seq(5,50,5), rfeControl=control)\nresults\n# list the chosen features\npredictors(results)\n# plot the results\n\nresults2 <- rfe(miss2[,seq(ncol(Area_clean))], metadata, sizes=seq(5,50,5), rfeControl=control)\nresults2\n\n# list the chosen features\n# plot the results\n\nresults3 <- rfe(miss2[,(ncol(Area_clean)+1):ncol(miss2)], metadata, sizes=seq(5,50,5), rfeControl=control)\nresults3\n\n# list the chosen features\n# plot the results\n\n\n\n\nshift <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/MTBLS237_session_2_associated_data/shift.csv\")[,-1])\nfitting_error <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/MTBLS237_session_2_associated_data/fitting_error.csv\")[,-1])\nsignal_area_ratio <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/MTBLS237_session_2_associated_data/signal_area_ratio.csv\")[,-1])\nArea=data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/MTBLS237_session_2_associated_data/quantification.csv\")[,-1])\nind=which(is.na(colSums(fitting_error)))\nArea[signal_area_ratio<5]=NA\nArea[,-ind][fitting_error[,-ind]>0.1]=NA\n\nshift[signal_area_ratio<5]=NA\nshift[,-ind][fitting_error[,-ind]>0.1]=NA\nshift=shift[,-ind]\n\nmetadata <- factor(as.vector(as.data.frame(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/Metadata.csv\"))[,3]))\nfor (j in unique(metadata)) {\n  for (i in seq(ncol(Area))) {\n    Area[(Area[which(metadata==j),i] %in% boxplot.stats(Area[which(metadata==j),i])$out),i]=NA\n  }\n  for (i in seq(ncol(shift))) {\n    shift[(shift[which(metadata==j),i] %in% boxplot.stats(shift[which(metadata==j),i])$out),i]=NA\n  }\n}\n\nind=apply(Area,2,function(x)length(which(is.na(x))))\n\nArea_clean=Area[,ind<30]\nind=apply(shift,2,function(x)length(which(is.na(x))))\n\nshift_clean=shift[,ind<30]\nind=c()\ndef=sapply(colnames(Area_clean),function(x)substr(x,1,nchar(x)-2))\ndef2=which(duplicated(def)==F)\ndef4=apply(Area_clean,2,function(x)length(which(is.na(x))))\nfor (i in def2) {\n  def3=which(def==def[i])\n  ind=c(ind,def3[which.min(def4[def3])])\n}\nArea_clean=Area_clean[,ind]\n\ncolnames(shift_clean)=paste(colnames(shift_clean),'shift',sep='_')\n\ncombined_mtbls374=as.data.frame(cbind(Area_clean,shift_clean))\n\nmiss=missForest(data.matrix(combined_mtbls374))$ximp\nmiss2=scale(miss,center=T,scale=T)\nresults <- rfe(miss2, metadata, sizes=seq(5,50,5), rfeControl=control)\nresults\n# list the chosen features\npredictors(results)\n# plot the results\n\nresults2 <- rfe(miss2[,seq(ncol(Area_clean))], metadata, sizes=seq(5,50,5), rfeControl=control)\nresults2\n\n# list the chosen features\n# plot the results\n\nresults3 <- rfe(miss2[,(ncol(Area_clean)+1):ncol(miss2)], metadata, sizes=seq(5,50,5), rfeControl=control)\nresults3\n#\n# shift <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS242_20170211_113451/data_analysis/output_info/shift.csv\")[,-1])\n# fitting_error <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS242_20170211_113451/data_analysis/output_info/fitting_error.csv\")[,-1])\n# signal_area_ratio <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS242_20170211_113451/data_analysis/output_info/signal_area_ratio.csv\")[,-1])\n# Area=data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS242_20170211_113451/data_analysis/output_info/Area.csv\")[,-1])\n# Area[signal_area_ratio<5]=NA\n# Area[fitting_error>0.15]=NA\n# ind=apply(Area,2,function(x)length(which(is.na(x))))\n# # shift_clean=shift[,ind<64]\n# Area_clean=Area[,ind<40]\n# shift[signal_area_ratio<5]=NA\n# shift[fitting_error>0.15]=NA\n# ind=apply(shift,2,function(x)length(which(is.na(x))))\n# # shift_clean=shift[,ind<64]\n# shift_clean=shift[,ind<40]\n# metadata <- factor(as.vector(as.data.frame(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS242_20170211_113451/data_analysis/Metadata.csv\"))[,3]))\n#\n# asd=apply(Area_clean,2,function(x) wilcox.test(x[which(metadata=='0')],x[which(metadata=='2')])$p.value)\n# asd2=apply(shift_clean,2,function(x) wilcox.test(x[which(metadata=='0')],x[which(metadata=='2')])$p.value)\n# sort(asd)\n# sort(asd2)\n# colnames(shift_clean)=paste(colnames(Area_clean),'shift',sep='_')\n#\n# combined_mtbls242=as.data.frame(cbind(metadata,Area_clean,shift_clean))\n# miss=missForest(combined_mtbls242[,-1])$ximp\n# miss2=scale(miss,center=T,scale=T)\n# results <- rfe(miss2, metadata, sizes=seq(3,30,3), rfeControl=control)\n# print(results)\n# # list the chosen features\n# predictors(results)\n# # plot the results\n# plot(results, type=c(\"g\", \"o\"))\n#\n# results2 <- rfe(miss2[,1:(ncol(miss2)/2)], metadata, sizes=seq(3,30,3), rfeControl=control)\n# # list the chosen features\n# # plot the results\n# plot(results2, type=c(\"g\", \"o\"))\n#\n# results3 <- rfe(miss2[,(ncol(miss2)/2+1):(ncol(miss2))], metadata, sizes=seq(3,30,3), rfeControl=control)\n# # list the chosen features\n# # plot the results\n# plot(results3, type=c(\"g\", \"o\"))\n#\n#\n\nDiffs_Ratios <- as.data.frame(read_excel(\"C:/Users/Usuario/Downloads/Diffs_Ratios.xlsx\",  sheet = \"Area + Pos\"))\nmiss=missForest(Diffs_Ratios[,4:98])$ximp\nfor (i in seq(ncol(miss))) miss[(miss[,i] %in% boxplot.stats(miss[,i])$out),i]=NA\nmiss=missForest(miss)$ximp\n\nresults <- rfe(miss, factor(Diffs_Ratios[,2]), sizes=seq(3,30,3), rfeControl=control)\nprint(results)\npredictors(results)\n\nresults2 <- rfe(miss[,1:42], factor(Diffs_Ratios[,2]), sizes=seq(3,30,3), rfeControl=control)\nprint(results2)\npredictors(results2)\n\nresults3 <- rfe(miss[,43:95], factor(Diffs_Ratios[,2]), sizes=seq(3,30,3), rfeControl=control)\nprint(results3)\npredictors(results3)\n\n\nresults <- rfe(miss[1:75,], factor(Diffs_Ratios[1:75,3]), sizes=seq(3,30,3), rfeControl=control)\nprint(results)\npredictors(results)\n\nresults2 <- rfe(miss[1:75,1:42], factor(Diffs_Ratios[1:75,3]), sizes=seq(3,30,3), rfeControl=control)\nprint(results2)\npredictors(results2)\n\nresults3 <- rfe(miss[1:75,43:95], factor(Diffs_Ratios[1:75,3]), sizes=seq(3,30,3), rfeControl=control)\nprint(results3)\npredictors(results3)\n\n\n\nresults <- rfe(miss[76:154,], factor(Diffs_Ratios[76:154,3]), sizes=seq(3,30,3), rfeControl=control)\nprint(results)\npredictors(results)\n\nresults2 <- rfe(miss[76:154,1:42], factor(Diffs_Ratios[76:154,3]), sizes=seq(3,30,3), rfeControl=control)\nprint(results2)\npredictors(results2)\n\nresults3 <- rfe(miss[76:154,43:95], factor(Diffs_Ratios[76:154,3]), sizes=seq(3,30,3), rfeControl=control)\nprint(results3)\npredictors(results3)\n",
    "created" : 1493585252020.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2834403630",
    "id" : "12CC22D0",
    "lastKnownWriteTime" : 1493585471,
    "last_content_update" : 1493585471407,
    "path" : "C:/Users/Usuario/Downloads/data_structure_combination.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 8,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}