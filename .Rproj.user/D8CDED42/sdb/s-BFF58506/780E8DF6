{
    "collab_server" : "",
    "contents" : "#' STOCSY or RANSY identification tool.\n#'\n#' @param dataset Dataset\n#' @param ppm ppm axis\n#' @param limits Left and right edges of the region to correlate with the rest of spectrum.\n#' @param method Method ('pearson','spearman','ransy').\n#'\n#' @return interactive plot\n#' @export identification_tool\n#' @import plotly\n#' @examples\n#' setwd(paste(system.file(package = \"rDolphin\"),\"extdata\",sep='/'))\n#' imported_data=import_data(\"Parameters_MTBLS242_15spectra_5groups.csv\")\n#' identification_tool(imported_data$dataset,imported_data$ppm,c(1,0.995),'spearman')\n\n\n\nidentification_tool= function(dataset,ppm,limits,method) {\n  ROI_buckets = which.min(abs(as.numeric(limits[1])-ppm)):which.min(abs(as.numeric(limits[2])-ppm))\n\n  if (method=='ransy') {\n    #Loosely based on equivalent function in 'muma' R package\n    driver = rowSums(dataset[, ROI_buckets]) %*% matrix(rep(1, ncol(dataset)),nrow=1)\n    R = apply(dataset/driver,2,function(x)median(x,na.rm=T))/apply(dataset/driver, 2, function(x)mad(x,na.rm=T))\n    R[R==Inf]=max(R[is.finite(R)])\n    R [is.na(R)]=0\n    cor_values=R/max(R,na.rm=T)\n  } else {\n    cor_values=as.vector(cor(rowSums(dataset[,ROI_buckets]),dataset,method=method))\n  }\n\n\nYdata = apply(dataset,2,median)\nay <- list(tickfont = list(color = \"red\"),overlaying = \"y\",side = \"right\",title = \"correlation\",range = c(0, max(Ydata)))\naz = list(title = \"Intensity\",range = c(-1, max(Ydata)-1))\np=plot_ly()%>%\n  add_lines(x=~ppm,y = ~Ydata,name='Median spectrum')%>%\n  add_lines(x=~ppm,y = ~cor_values, name='Correlation',yaxis = \"y2\")%>%\n  layout(xaxis=list(title='ppm',range=c(max(ppm),min(ppm))),yaxis=az, yaxis2 = ay)\n\nreturn(p)\n}\n",
    "created" : 1506244159992.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1534045089",
    "id" : "780E8DF6",
    "lastKnownWriteTime" : 1506244372,
    "last_content_update" : 1506244372432,
    "path" : "~/GitHub/rDolphin/R/identification_tool.R",
    "project_path" : "R/identification_tool.R",
    "properties" : {
    },
    "relative_order" : 15,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}