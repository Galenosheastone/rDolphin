{
    "collab_server" : "",
    "contents" : "\nlibrary(readr)\nlibrary(data.table)\nlibrary(mlbench)\nlibrary(caret)\n# load the data\n\ncontrol <- rfeControl(functions=rfFuncs, method=\"cv\", number=50)\n\nlibrary(readxl)\n# combined_mtbls374 <- as.data.frame(read_excel(\"~/combined_mtbls374.xlsx\"))\nlibrary(missForest)\nshift <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/MTBLS374_example_associated_data/shift.csv\")[,-1])\nfitting_error <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/MTBLS374_example_associated_data/fitting_error.csv\")[,-1])\nsignal_area_ratio <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/MTBLS374_example_associated_data/signal_area_ratio.csv\")[,-1])\nArea=data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/MTBLS374_example_associated_data/quantification.csv\")[,-1])\nArea[signal_area_ratio<5]=NA\nArea[fitting_error>0.1]=NA\nind=apply(Area,2,function(x)length(which(is.na(x))))\n# shift_clean=shift[,ind<64]\nArea_clean=Area[,ind<30]\nshift[signal_area_ratio<5]=NA\nshift[fitting_error>0.1]=NA\nind=apply(shift,2,function(x)length(which(is.na(x))))\n# shift_clean=shift[,ind<64]\nshift_clean=shift[,ind<30]\ncolnames(shift_clean)=paste(colnames(Area_clean),'shift',sep='_')\n\naa=fread(\"C:/Bruker/TopSpin3.2/data/MTBLS374/s_BoEfRTP2 Serum NMR.txt\")\naa=aa[which(!is.na(aa$`Factor Value[smoking status]`)),]\nmetadata=factor(aa$`Factor Value[smoking status]`)\ncombined_mtbls374=as.data.frame(cbind(Area_clean,shift_clean))\n# ab=fread(\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/Metadata.csv\")\n# ab=ab[as.numeric(as.matrix(aa[,1])),]\n# ab[,2]=seq(nrow(ab))\n# ab[which(metadata=='Never Smoker'),3]=0\n# ab[which(metadata=='Smoker'),3]=1\n# fwrite(ab,file=\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/Metadata_edited.csv\")\n#\n\n\n\n# asd=apply(Area_clean,2,function(x) wilcox.test(x[which(metadata[,1]=='Never Smoker')],x[which(metadata[,1]=='Smoker')])$p.value)\n# asd2=apply(shift_clean,2,function(x) wilcox.test(x[which(metadata[,1]=='Never Smoker')],x[which(metadata[,1]=='Smoker')])$p.value)\n# show(asd)\n# sort(asd)\n# sort(asd2)\n#\n#\n#\n#\n#\n#\n#\n# set.seed(7)\n# load the library\n\n\nmiss=missForest(data.matrix(combined_mtbls374))$ximp\nmiss2=scale(miss,center=T,scale=T)\nresults <- rfe(miss2, metadata, sizes=seq(5,50,5), rfeControl=control)\nprint(results)\n# list the chosen features\npredictors(results)\n# plot the results\n\nresults2 <- rfe(miss2[,1:(ncol(miss2)/2)], metadata, sizes=seq(5,ncol(miss2)/2,5), rfeControl=control)\nprint(results2)\n\n# list the chosen features\n# plot the results\n\nresults3 <- rfe(miss2[,(ncol(miss2)/2+1):(ncol(miss2))], metadata, sizes=seq(5,ncol(miss2)/2,5), rfeControl=control)\nprint(results3)\n\n# list the chosen features\n# plot the results\n\n\n\n\nshift <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/prova7_associated_data/shift.csv\")[,-1])\nfitting_error <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/prova7_associated_data/fitting_error.csv\")[,-1])\nsignal_area_ratio <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/prova7_associated_data/signal_area_ratio.csv\")[,-1])\nArea=data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/prova7_associated_data/quantification.csv\")[,-1])\nArea[signal_area_ratio<5]=NA\nArea[fitting_error>0.1]=NA\nind=apply(Area,2,function(x)length(which(is.na(x))))\n# shift_clean=shift[,ind<64]\nArea_clean=Area[,ind<30]\nshift[signal_area_ratio<5]=NA\nshift[fitting_error>0.1]=NA\nind=apply(shift,2,function(x)length(which(is.na(x))))\n# shift_clean=shift[,ind<64]\nshift_clean=shift[,ind<30]\ncolnames(shift_clean)=paste(colnames(Area_clean),'shift',sep='_')\n\nmetadata <- factor(as.vector(as.data.frame(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/Metadata.csv\"))[,3]))\n#\n# asd=apply(Area_clean,2,function(x) wilcox.test(x[which(metadata[,1]=='1')],x[which(metadata[,1]=='3')])$p.value)\n# asd2=apply(shift_clean,2,function(x) wilcox.test(x[which(metadata[,1]=='1')],x[which(metadata[,1]=='3')])$p.value)\n# sort(asd)\n# sort(asd2)\ncolnames(shift_clean)=paste(colnames(Area_clean),'shift',sep='_')\n\ncombined_mtbls237=as.data.frame(cbind(metadata,Area_clean,shift_clean))\nmiss=missForest(combined_mtbls237[,-1])$ximp\nmiss2=scale(miss,center=T,scale=T)\nresults <- rfe(miss2, metadata, sizes=seq(3,30,3), rfeControl=control)\n\n\nresults2 <- rfe(miss2[,1:(ncol(miss2)/2)], metadata, sizes=seq(3,30,3), rfeControl=control)\n# list the chosen features\n# plot the results\n\nresults3 <- rfe(miss2[,(ncol(miss2)/2+1):(ncol(miss2))], metadata, sizes=seq(3,30,3), rfeControl=control)\n# list the chosen features\n# plot the results\nplot(results, type=c(\"g\", \"o\"),main=\"Accuracy of classification of samples according to combined \\n shift and area data\",xlab=\"Number of variables chosen\")\nplot(results2, type=c(\"g\", \"o\"),main=\"Accuracy of classification of samples according to area data\",xlab=\"Number of variables chosen\")\nplot(results3, type=c(\"g\", \"o\"),main=\"Accuracy of classification of samples according to shift data\",xlab=\"Number of variables chosen\")\n\n#\n# shift <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS242_20170211_113451/data_analysis/output_info/shift.csv\")[,-1])\n# fitting_error <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS242_20170211_113451/data_analysis/output_info/fitting_error.csv\")[,-1])\n# signal_area_ratio <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS242_20170211_113451/data_analysis/output_info/signal_area_ratio.csv\")[,-1])\n# Area=data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS242_20170211_113451/data_analysis/output_info/Area.csv\")[,-1])\n# Area[signal_area_ratio<5]=NA\n# Area[fitting_error>0.15]=NA\n# ind=apply(Area,2,function(x)length(which(is.na(x))))\n# # shift_clean=shift[,ind<64]\n# Area_clean=Area[,ind<40]\n# shift[signal_area_ratio<5]=NA\n# shift[fitting_error>0.15]=NA\n# ind=apply(shift,2,function(x)length(which(is.na(x))))\n# # shift_clean=shift[,ind<64]\n# shift_clean=shift[,ind<40]\n# metadata <- factor(as.vector(as.data.frame(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS242_20170211_113451/data_analysis/Metadata.csv\"))[,3]))\n#\n# asd=apply(Area_clean,2,function(x) wilcox.test(x[which(metadata=='0')],x[which(metadata=='2')])$p.value)\n# asd2=apply(shift_clean,2,function(x) wilcox.test(x[which(metadata=='0')],x[which(metadata=='2')])$p.value)\n# sort(asd)\n# sort(asd2)\n# colnames(shift_clean)=paste(colnames(Area_clean),'shift',sep='_')\n#\n# combined_mtbls242=as.data.frame(cbind(metadata,Area_clean,shift_clean))\n# miss=missForest(combined_mtbls242[,-1])$ximp\n# miss2=scale(miss,center=T,scale=T)\n# results <- rfe(miss2, metadata, sizes=seq(3,30,3), rfeControl=control)\n# print(results)\n# # list the chosen features\n# predictors(results)\n# # plot the results\n# plot(results, type=c(\"g\", \"o\"))\n#\n# results2 <- rfe(miss2[,1:(ncol(miss2)/2)], metadata, sizes=seq(3,30,3), rfeControl=control)\n# # list the chosen features\n# # plot the results\n# plot(results2, type=c(\"g\", \"o\"))\n#\n# results3 <- rfe(miss2[,(ncol(miss2)/2+1):(ncol(miss2))], metadata, sizes=seq(3,30,3), rfeControl=control)\n# # list the chosen features\n# # plot the results\n# plot(results3, type=c(\"g\", \"o\"))\n#\n#\n\nDiffs_Ratios <- as.data.frame(read_excel(\"C:/Users/Usuario/Downloads/Diffs_Ratios.xlsx\",  sheet = \"Area + Pos\"))\nmiss=missForest(Diffs_Ratios[,4:98])$ximp\nfor (i in seq(ncol(miss))) miss[(miss[,i] %in% boxplot.stats(miss[,i])$out),i]=NA\nmiss=missForest(miss)$ximp\n\nresults <- rfe(miss, factor(Diffs_Ratios[,2]), sizes=seq(3,30,3), rfeControl=control)\nprint(results)\npredictors(results)\n\nresults2 <- rfe(miss[,1:42], factor(Diffs_Ratios[,2]), sizes=seq(3,30,3), rfeControl=control)\nprint(results2)\npredictors(results2)\n\nresults3 <- rfe(miss[,43:95], factor(Diffs_Ratios[,2]), sizes=seq(3,30,3), rfeControl=control)\nprint(results3)\npredictors(results3)\n\n\nresults <- rfe(miss[1:75,], factor(Diffs_Ratios[1:75,3]), sizes=seq(3,30,3), rfeControl=control)\nprint(results)\npredictors(results)\n\nresults2 <- rfe(miss[1:75,1:42], factor(Diffs_Ratios[1:75,3]), sizes=seq(3,30,3), rfeControl=control)\nprint(results2)\npredictors(results2)\n\nresults3 <- rfe(miss[1:75,43:95], factor(Diffs_Ratios[1:75,3]), sizes=seq(3,30,3), rfeControl=control)\nprint(results3)\npredictors(results3)\n\n\n\nresults <- rfe(miss[76:154,], factor(Diffs_Ratios[76:154,3]), sizes=seq(3,30,3), rfeControl=control)\nprint(results)\npredictors(results)\n\nresults2 <- rfe(miss[76:154,1:42], factor(Diffs_Ratios[76:154,3]), sizes=seq(3,30,3), rfeControl=control)\nprint(results2)\npredictors(results2)\n\nresults3 <- rfe(miss[76:154,43:95], factor(Diffs_Ratios[76:154,3]), sizes=seq(3,30,3), rfeControl=control)\nprint(results3)\npredictors(results3)\n",
    "created" : 1493368886333.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "478348677",
    "id" : "FEBE4809",
    "lastKnownWriteTime" : 1493368978,
    "last_content_update" : 1493368978305,
    "path" : "C:/Users/Usuario/Downloads/data_structure_combination.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}