{
    "collab_server" : "",
    "contents" : "\nlibrary(readr)\nlibrary(data.table)\nlibrary(mlbench)\nlibrary(caret)\n# load the data\n\ncontrol <- rfeControl(functions=rfFuncs,  method = \"repeatedcv\",repeats = 5)\n\nlibrary(readxl)\n# combined_mtbls374 <- as.data.frame(read_excel(\"~/combined_mtbls374.xlsx\"))\nlibrary(missForest)\nshift <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/MTBLS374_session_5_associated_data/shift.csv\")[,-1])\nfitting_error <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/MTBLS374_session_5_associated_data/fitting_error.csv\")[,-1])\nsignal_area_ratio <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/MTBLS374_session_5_associated_data/signal_area_ratio.csv\")[,-1])\nArea=data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS374/data_analysis/MTBLS374_session_5_associated_data/quantification.csv\")[,-1])\nind=which(is.na(colSums(fitting_error)))\nArea[signal_area_ratio<5]=NA\nArea[,-ind][fitting_error[,-ind]>0.08]=NA\n\nshift[signal_area_ratio<5]=NA\nshift[,-ind][fitting_error[,-ind]>0.08]=NA\n# shift=shift[,-ind]\n\naa=fread(\"C:/Bruker/TopSpin3.2/data/MTBLS374/s_BoEfRTP2 Serum NMR.txt\")\naa=aa[which(!is.na(aa$`Factor Value[smoking status]`)),]\nmetadata=factor(aa$`Factor Value[smoking status]`)\nfor (j in unique(metadata)) {\n  for (i in seq(ncol(Area))) {\n    Area[(Area[which(metadata==j),i] %in% boxplot.stats(Area[which(metadata==j),i])$out),i]=NA\n  }\nfor (i in seq(ncol(shift))) {\n  shift[(shift[which(metadata==j),i] %in% boxplot.stats(shift[which(metadata==j),i])$out),i]=NA\n}\n}\n\nind=apply(Area,2,function(x)length(which(is.na(x))))\n\nArea_clean=Area[,ind<30]\nind=apply(shift,2,function(x)length(which(is.na(x))))\n\nshift_clean=shift[,ind<30]\nind=c()\ndef=sapply(colnames(Area_clean),function(x)substr(x,1,nchar(x)-2))\ndef2=which(duplicated(def)==F)\ndef4=apply(Area_clean,2,function(x)length(which(is.na(x))))\nfor (i in def2) {\n  def3=which(def==def[i])\n  ind=c(ind,def3[which.min(def4[def3])])\n}\nArea_clean=Area_clean[,ind]\nArea_clean=Area_clean[,-1]\n\n\ncolnames(shift_clean)=paste(colnames(shift_clean),'shift',sep='_')\n\ncombined_mtbls374=as.data.frame(cbind(Area_clean,shift_clean))\ncombined_mtbls374[combined_mtbls374==Inf]=NA\nmiss=missForest(data.matrix(combined_mtbls374))$ximp\nmiss2=scale(miss,center=T,scale=T)\nresults <- rfe(miss2, metadata, sizes=seq(5,50,5), rfeControl=control)\nresults\n# list the chosen features\npredictors(results)\n# plot the results\n\nresults2 <- rfe(miss2[,seq(ncol(Area_clean))], metadata, sizes=seq(5,50,5), rfeControl=control)\nresults2\npredictors(results2)\n\n\n# list the chosen features\n# plot the results\n\nresults3 <- rfe(miss2[,(ncol(Area_clean)+1):ncol(miss2)], metadata, sizes=seq(5,50,5), rfeControl=control)\nresults3\npredictors(results3)\n\n\n# list the chosen features\n# plot the results\n\n\n\n\nshift <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/MTBLS237_session_5_associated_data/shift.csv\")[,-1])\nfitting_error <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/MTBLS237_session_5_associated_data/fitting_error.csv\")[,-1])\nsignal_area_ratio <- data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/MTBLS237_session_5_associated_data/signal_area_ratio.csv\")[,-1])\nArea=data.matrix(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/MTBLS237_session_5_associated_data/quantification.csv\")[,-1])\nind=which(is.na(colSums(fitting_error)))\nArea[signal_area_ratio<5]=NA\nArea[,-ind][fitting_error[,-ind]>0.1]=NA\n\nshift[signal_area_ratio<5]=NA\nshift[,-ind][fitting_error[,-ind]>0.1]=NA\n# shift=shift[,-ind]\n\nmetadata <- factor(as.vector(as.data.frame(read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/Metadata.csv\"))[,3]))\nfor (j in unique(metadata)) {\n  for (i in seq(ncol(Area))) {\n    Area[(Area[which(metadata==j),i] %in% boxplot.stats(Area[which(metadata==j),i])$out),i]=NA\n  }\n  for (i in seq(ncol(shift))) {\n    shift[(shift[which(metadata==j),i] %in% boxplot.stats(shift[which(metadata==j),i])$out),i]=NA\n  }\n}\n\nind=apply(Area,2,function(x)length(which(is.na(x))))\n\nArea_clean=Area[,ind<30]\nind=apply(shift,2,function(x)length(which(is.na(x))))\n\nshift_clean=shift[,ind<30]\nind=c()\ndef=sapply(colnames(Area_clean),function(x)substr(x,1,nchar(x)-2))\ndef2=which(duplicated(def)==F)\ndef4=apply(Area_clean,2,function(x)length(which(is.na(x))))\nfor (i in def2) {\n  def3=which(def==def[i])\n  ind=c(ind,def3[which.min(def4[def3])])\n}\nArea_clean=Area_clean[,ind]\nArea_clean=Area_clean[,-1]\n\ncolnames(shift_clean)=paste(colnames(shift_clean),'shift',sep='_')\ncombined_mtbls237=as.data.frame(cbind(Area_clean,shift_clean))\n\nmiss=missForest(data.matrix(combined_mtbls237))$ximp\n\nmiss2=scale(miss,center=T,scale=T)\n\nind=which(metadata==4)\nmiss2=miss2[-ind,]\nmetadata=droplevels(metadata[-ind])\n\nresults <- rfe(miss2, metadata, sizes=seq(5,50,5), rfeControl=control)\nresults\n# list the chosen features\npredictors(results)\n# plot the results\n\nresults2 <- rfe(miss2[,seq(ncol(Area_clean))], metadata, sizes=seq(5,50,5), rfeControl=control)\nresults2\npredictors(results2)\n\n# list the chosen features\n# plot the results\n\nresults3 <- rfe(miss2[,(ncol(Area_clean)+1):ncol(miss2)], metadata, sizes=seq(5,50,5), rfeControl=control)\nresults3\npredictors(results3)\n\n\n\n\n\nMetadata_expanded <- read_csv(\"C:/Bruker/TopSpin3.2/data/MTBLS237/data_analysis/Metadata_expanded.csv\")\nlel=matrix(NA,8,6)\nMetadata_expanded$Factor.Value.Disease.Characterisation..[which(is.na(Metadata_expanded$Factor.Value.Disease.Characterisation..))]=\"Control\"\n\nind=sort(c(which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"activeUC\"),which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"inactiveUC\")))\nresults <- rfe(miss2[ind,], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults\npredictors(results)\nresults2 <- rfe(miss2[ind,seq(ncol(Area_clean))], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults2\npredictors(results2)\nresults3 <- rfe(miss2[ind,(ncol(Area_clean)+1):ncol(miss2)], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults3\npredictors(results3)\nlel[1,]=unlist(c(results$results[which.max(results$results[,2]),c(2,4)],results2$results[which.max(results2$results[,2]),c(2,4)],results3$results[which.max(results3$results[,2]),c(2,4)]))\n\n\n\nind=sort(c(which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"activeUC\"),which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"Control\")))\nresults <- rfe(miss2[ind,], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults\npredictors(results)\nresults2 <- rfe(miss2[ind,seq(ncol(Area_clean))], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults2\npredictors(results2)\nresults3 <- rfe(miss2[ind,(ncol(Area_clean)+1):ncol(miss2)], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults3\npredictors(results3)\nlel[2,]=unlist(c(results$results[which.max(results$results[,2]),c(2,4)],results2$results[which.max(results2$results[,2]),c(2,4)],results3$results[which.max(results3$results[,2]),c(2,4)]))\n\n\nind=sort(c(which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"Control\"),which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"inactiveUC\")))\nresults <- rfe(miss2[ind,], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults\npredictors(results)\nresults2 <- rfe(miss2[ind,seq(ncol(Area_clean))], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults2\npredictors(results2)\nresults3 <- rfe(miss2[ind,(ncol(Area_clean)+1):ncol(miss2)], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults3\npredictors(results3)\nlel[3,]=unlist(c(results$results[which.max(results$results[,2]),c(2,4)],results2$results[which.max(results2$results[,2]),c(2,4)],results3$results[which.max(results3$results[,2]),c(2,4)]))\n\n\nind=sort(c(which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"activeUC\"),which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"activeCD\")))\nresults <- rfe(miss2[ind,], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults\npredictors(results)\nresults2 <- rfe(miss2[ind,seq(ncol(Area_clean))], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults2\npredictors(results2)\nresults3 <- rfe(miss2[ind,(ncol(Area_clean)+1):ncol(miss2)], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults3\npredictors(results3)\nlel[4,]=unlist(c(results$results[which.max(results$results[,2]),c(2,4)],results2$results[which.max(results2$results[,2]),c(2,4)],results3$results[which.max(results3$results[,2]),c(2,4)]))\n\n\nind=sort(c(which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"inactiveUC\"),which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"inactiveCD\")))\nresults <- rfe(miss2[ind,], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults\npredictors(results)\nresults2 <- rfe(miss2[ind,seq(ncol(Area_clean))], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults2\npredictors(results2)\nresults3 <- rfe(miss2[ind,(ncol(Area_clean)+1):ncol(miss2)], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults3\npredictors(results3)\nlel[5,]=unlist(c(results$results[which.max(results$results[,2]),c(2,4)],results2$results[which.max(results2$results[,2]),c(2,4)],results3$results[which.max(results3$results[,2]),c(2,4)]))\n\n\nind=sort(c(which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"activeCD\"),which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"inactiveCD\")))\nresults <- rfe(miss2[ind,], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults\npredictors(results)\nresults2 <- rfe(miss2[ind,seq(ncol(Area_clean))], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults2\npredictors(results2)\nresults3 <- rfe(miss2[ind,(ncol(Area_clean)+1):ncol(miss2)], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults3\npredictors(results3)\nlel[6,]=unlist(c(results$results[which.max(results$results[,2]),c(2,4)],results2$results[which.max(results2$results[,2]),c(2,4)],results3$results[which.max(results3$results[,2]),c(2,4)]))\n\nind=sort(c(which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"Control\"),which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"activeCD\")))\nresults <- rfe(miss2[ind,], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults\npredictors(results)\nresults2 <- rfe(miss2[ind,seq(ncol(Area_clean))], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults2\npredictors(results2)\nresults3 <- rfe(miss2[ind,(ncol(Area_clean)+1):ncol(miss2)], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults3\npredictors(results3)\nlel[7,]=unlist(c(results$results[which.max(results$results[,2]),c(2,4)],results2$results[which.max(results2$results[,2]),c(2,4)],results3$results[which.max(results3$results[,2]),c(2,4)]))\n\n\n\nind=sort(c(which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"Control\"),which(Metadata_expanded$Factor.Value.Disease.Characterisation..==\"inactiveCD\")))\nresults <- rfe(miss2[ind,], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults\npredictors(results)\nresults2 <- rfe(miss2[ind,seq(ncol(Area_clean))], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults2\npredictors(results2)\nresults3 <- rfe(miss2[ind,(ncol(Area_clean)+1):ncol(miss2)], factor(Metadata_expanded$Factor.Value.Disease.Characterisation..[ind]), sizes=seq(5,50,5), rfeControl=control)\nresults3\npredictors(results3)\nlel[8,]=unlist(c(results$results[which.max(results$results[,2]),c(2,4)],results2$results[which.max(results2$results[,2]),c(2,4)],results3$results[which.max(results3$results[,2]),c(2,4)]))\n",
    "created" : 1493720628071.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4043410571",
    "id" : "54B93336",
    "lastKnownWriteTime" : 1493800536,
    "last_content_update" : 1493800536654,
    "path" : "C:/Users/Usuario/Downloads/data_structure_combination.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}